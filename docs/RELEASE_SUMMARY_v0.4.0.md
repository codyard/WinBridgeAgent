# ClawDesk MCP Server v0.4.0 发布摘要

## 发布信息

**版本**：0.4.0  
**发布日期**：2026年2月4日  
**构建时间**：19:46

## 构建信息

### x64 版本

- **文件大小**：2.0 MB
- **MD5 校验和**：e551462b9c0e208db12a795375fd876b
- **文件名**：ClawDeskMCP-x64.exe

### x86 版本

- **文件大小**：2.1 MB
- **MD5 校验和**：ae576f3b8893d0dc491acdffe5469821
- **文件名**：ClawDeskMCP-x86.exe

## 主要更新

### 1. 单实例检测机制 ⭐ NEW

防止同时运行多个程序实例，提供更好的用户体验：

- ✅ 使用 Windows 互斥锁实现跨进程检测
- ✅ 自动向旧实例发送退出命令
- ✅ 优雅等待旧实例退出（最多8秒）
- ✅ 超时保护和友好提示
- ✅ 完善的资源清理机制

**用户体验**：双击程序图标相当于"重启"程序，无需手动关闭旧实例。

**详细文档**：`SINGLEINSTANCE_v0.4.0.md`

### 2. 设置窗口（Settings Window）

全新的图形化设置界面，支持所有配置项的可视化管理：

#### 语言设置

- 支持 9 种语言：简体中文、繁体中文、英语、日语、韩语、德语、法语、西班牙语、俄语
- 系统语言自动检测
- 实时切换，立即生效
- ✅ **修复**：语言选择后立即保存，重启后保持选择
- ✅ **修复**：下拉框增加滚动条，所有语言都可见

#### 启动设置

- Windows 开机自启动（注册表管理）
- 一键启用/禁用

#### API Key 管理

- 显示当前 API Key（脱敏显示）
- 一键复制到剪贴板
- 重新生成 API Key
- 实时格式验证

#### 服务器设置

- 端口配置（1024-65535）
- 自动端口选择
- 监听地址（0.0.0.0 或 127.0.0.1）
- 服务器状态显示

#### 安全设置

- Bearer Token 管理
- 允许的目录白名单
- 允许的应用程序白名单
- 允许的命令白名单
- 高风险操作确认开关

#### 外观设置

- Dashboard 自动显示
- Dashboard 窗口置顶
- 托盘图标样式（普通/简约）
- 日志保留天数

#### 关于页面

- 版本信息
- 许可证类型和到期时间
- 操作系统和架构信息
- 文档和支持链接

### 3. 本地化支持（Localization）

完整的多语言支持系统：

- ✅ 9 种语言的翻译资源
- ✅ 系统语言自动检测
- ✅ 运行时语言切换
- ✅ 翻译键缺失时自动回退到英语
- ✅ 硬编码英语翻译作为后备方案
- ✅ 托盘菜单本地化
- ✅ 所有 UI 元素本地化

### 4. 编译修复

- ✅ 修复 settings*window.h 中重复的 uiFont* 声明
- ✅ 修复 x86 构建中的 lambda 函数调用约定问题
- ✅ 使用 CALLBACK 函数替代 lambda 以兼容 Windows API
- ✅ 所有警告已处理

## 技术改进

### 代码质量

- 完善的错误处理
- 资源清理机制
- 线程安全的互斥锁使用
- 符合 Windows API 规范

### 项目结构

- 文档统一到 `docs/` 目录
- 脚本统一到 `scripts/` 目录
- 配置模板统一到 `configs/` 目录
- 构建输出统一到 `build/` 目录

### 构建系统

- CMakeLists.txt 优化
- 添加必要的库链接（comctl32）
- 版本号管理改进

## 已知问题

无重大已知问题。

## 测试建议

### 单实例检测测试

1. 启动程序，验证正常运行
2. 再次双击程序图标，验证旧实例自动退出，新实例启动
3. 使用任务管理器挂起进程，再次启动，验证超时提示

### 语言设置测试

1. 打开设置窗口，切换语言
2. 验证 UI 立即更新
3. 关闭并重新打开设置窗口，验证语言保持
4. 重启程序，验证语言保持

### 设置窗口测试

1. 测试所有标签页的功能
2. 测试白名单的添加、编辑、删除、排序
3. 测试 Apply、OK、Cancel 按钮
4. 测试输入验证（端口范围、日志天数等）

### 自启动测试

1. 启用自启动，重启电脑，验证程序自动启动
2. 禁用自启动，重启电脑，验证程序不自动启动

## 升级说明

### 从 v0.3.0 升级

1. **备份配置文件**：

    ```
    备份 config.json 和 usage.json
    ```

2. **替换可执行文件**：

    ```
    替换 ClawDeskMCP.exe 为新版本
    ```

3. **首次启动**：
    - 程序会自动检测系统语言
    - 可以通过托盘菜单 -> Settings 打开设置窗口
    - 建议检查并配置安全白名单

4. **配置迁移**：
    - 旧版本的配置会自动保留
    - 新增的配置项会使用默认值
    - 建议打开设置窗口检查所有配置

### 新安装

1. **下载文件**：
    - x64 系统：ClawDeskMCP-x64.exe
    - x86 系统：ClawDeskMCP-x86.exe

2. **首次运行**：
    - 程序会创建默认配置文件
    - 建议立即打开设置窗口配置

3. **防火墙规则**：
    - 首次运行时会提示添加防火墙规则
    - 建议允许以确保正常通信

## 部署位置

测试版本已部署到：`/Volumes/Test/ClawDeskMCP/`

包含文件：

- ClawDeskMCP-x64.exe (2.0MB)
- ClawDeskMCP-x86.exe (2.1MB)
- config.template.json
- README.md
- translations.json

## 相关文档

- `SINGLEINSTANCE_v0.4.0.md` - 单实例检测机制详细说明
- `BUGFIX_LANGUAGE_v0.4.0.md` - 语言设置修复详情
- `CHANGELOG.md` - 完整更新日志
- `README.md` - 项目说明和使用指南

## 开发团队

感谢所有参与 v0.4.0 开发的贡献者！

## 下一步计划

v0.5.0 计划功能：

- 插件系统
- 更多 MCP 工具
- 性能优化
- 更多语言支持

---

**注意**：本版本已通过完整的编译测试，建议在生产环境部署前进行充分测试。
